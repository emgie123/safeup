@model SafeUp.Models.ViewModels.ManagementViewModel
@{
    Layout = null;
}



<div id="panel-replace-div">
    <div id="my-modal-title" class="modal-title"></div>
    <div id="partial-content" class="row">
        <div class="col-lg-12">
            <h4>@Model.GroupName <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></h4>
            <table class="table">
                <thead>
                <tr>
                    <th>Lp.</th>
                    <th>Login</th>
                    <th></th>

                </tr>
                </thead>
                <tbody>
                @{
                    int counter = 0;
                    int maxElement = Model.UsersList.Rows.Count();

                }
                @for (int i = 0; i < maxElement; i++)
                {
                    counter++;
                    <tr>
                        <td>@counter</td>
                        <td>@Model.UsersList.Rows.AsEnumerable().ElementAt(i).Value.Login</td>
                        <td>
                            @* potrzebne jescze group id *@
                            @Ajax.ActionLink("Usuń", "RemoveUserFromGroup", "MyManagement",
                                new {userId = Model.UsersList.Rows.AsEnumerable().ElementAt(i).Value.ID, groupId = Model.GroupId, groupName = Model.GroupName}, new AjaxOptions()
                                {
                                    HttpMethod = "GET",
                                    InsertionMode = InsertionMode.Replace,
                                    UpdateTargetId = "panel-replace-div",
                                },
                                new {@class = "btn btn-danger", type = "button", style = "border-radius:0; width: 140px; "})

                        </td>
                        <td></td>

                    </tr>

                }
                <tr>
                    <td>
                        <input id="login-input-box" type="text" placeholder="login" style="margin-top: 10%"/>
                    </td>
                    <td>

                    </td>
                    <td>
                        <button id="ajax-add-user-button"  class="btn btn-success" type="button" style="border-radius:0; width: 140px; margin-top: 8%"
                                data-userLogin="" data-groupId="@Model.GroupId" data-groupName="@Model.GroupName" data-errorMessage="@Model.Message">
                            Dodaj
                        </button>

                    
                    </td>

                </tr>

                </tbody>


            </table>





        </div>

    </div>

</div>

<script>
    function replaceLoginInputBox() {

        var inputBoxText = $("#login-input-box").val();

        if (inputBoxText === "") {
            alert("Podaj login");
            return;
        }

        //$("#ajax-add-user-button").attr("data-groupid");
  
        var groupId = $("#ajax-add-user-button").data("groupid");
        var groupName = $("#ajax-add-user-button").data("groupname");

        var controlerUrl = "/MyManagement/AddUserToGroup?userLogin=" + inputBoxText + "&groupID=" + groupId + "&groupName=" + groupName;
        $.ajax(
            {
                url: controlerUrl,
                success: function (partial) {
          
                    $("#panel-replace-div").html(partial);
                    var message = $("#ajax-add-user-button").data("errormessage");

                    $("#login-input-box").val("");

                    if (message !== "") { alert($("#ajax-add-user-button").data("errormessage")); }  
                
                }
                
            }
            );

    }


    $("#ajax-add-user-button").on("click", replaceLoginInputBox);


</script>