@model SafeUp.Models.DBPOSTGREs.Table<SafeUp.Models.SafeUpModels.File>

@{

    Layout = null;

}

<div id="partial-content" class="row">
    <div class="col-lg-12">
        <h2>Moje pliki</h2>
        <div class="panel panel-default">
            <table class="table">
                <thead>
                <tr>
                    <th>Lp.</th>
                    <th>Nazwa pliku</th>
                    <th>Data dodania</th>
                    <th>Rozmiar</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                @{int counter = 0;}
                @foreach (var file in Model.Rows.Values)
                {
                    counter++;
                    <tr>
                        <td>@counter</td>
                        <td>@file.Name</td>
                        <td>@file.CreatedOn</td>
                        <td>@file.Size</td>
                        <td>
                            @Ajax.ActionLink("Udostępnij", "ShareFile", "MyFiles", new {IdFile = file.ID},
                                new AjaxOptions()
                                {
                                    UpdateTargetId = "modal-content",
                                    HttpMethod = "GET",
                                    InsertionMode = InsertionMode.Replace,
                                    LoadingElementId = "loading"
                                },
                                new {@class = "btn btn-info", type = "button", style = "border-radius:0;", data_toggle = "modal", data_target = "#myfiles-modal-div"})
                        </td>
                        <td>
                            @using (Ajax.BeginForm(
                                "DownloadFile", "MyFiles",
                                new { fileId = file.ID },
                                new AjaxOptions()
                                {
                                    HttpMethod = "GET",
                                    OnSuccess = "StartDownloadFile(data)"
                                },
                                new { }

                                ))
                                {

                                    @Html.AntiForgeryToken()

                                    <input type="hidden" name="fileId" value="@file.ID" />
                                    <button id="@string.Format("directly-shared-file{0}", file.ID)" type="submit" value="Pobierz" class="btn btn-success" style="border-radius: 0; width: 140px;" target="blank">Pobierz</button>



                                }
                        </td>
                    </tr>


                }
                </tbody>


            </table>

            <div class="modal fade" id="myfiles-modal-div" style="margin-top: 5%;">
                <div class="modal-dialog">
                    <div id="modal-content">
                        
                    </div>
                </div>
            </div>




    </div>
       @using (Ajax.BeginForm(
                                "UploadFile", "MyFiles",
                                null,
                                new AjaxOptions()
                                {
                                    HttpMethod = "POST",
                       
                                },
                                new { enctype = "multipart/form-data" }
                                

                                ))
       {

        @Html.AntiForgeryToken()



           <input type="file" name="file"/>
           <br/>
          <input id="upload-button" type="submit" value="Wyślij" class="btn btn-warning" style="border-radius: 0; width: 140px;" target="blank"/>


       }
  


    </div>

</div>

<script src="~/Scripts/jquery-2.1.3.min.js"></script>

<script>
        function StartDownloadFile(url) {
            window.open(url);
        }


</script>